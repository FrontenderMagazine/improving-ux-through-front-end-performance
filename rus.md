# Улучшение опыта взаимодействия путем оптимизации производительности интерфейса

Представьте что вы стоите на перекрестке и ждете когда можно будет перейти 
дорогу. Вы нажимаете кнопку переключения светофора и достаете телефон. Вы хотите 
совершить какое-то действие: возможно проверить почту, добавить заметку в список 
задач или просмотреть ленту Twitter. У вас ограниченое количество времени на то, 
чтобы совершить это действие. 

Именно такое количество времени есть у пользователей, которые хотят совершить 
какое-либо действие с помощью вашего сайта. И очень важно это учитывать. 

Согласно исследованию Google, дополнительные полсекунды при загрузке страницы 
поиска могут снизить трафик и прибыль от рекламы на 20 процентов. [Статья об 
этом исследовании][1] также содержит данные о подсчетах команды Amazon, согласно 
которым дополнительные 100 *милисекунд* задержки при загрузке страниц сокращают 
обьемы продаж на 1 процент. Пользователи рассчитывают что страница загрузится за 
две секунды, подождав три секунды до 40 процентов из них [просто покинут 
сайт][2]. 

Вы способны идти в ногу с этими требованиями? Если вы, как и большинство из нас, 
занимаетесь разработкой сайтов, насыщенных контентом, множеством динамических 
элементов, большими файлами JavaScript и сложной графикой, ответ скорее всего 
«нет». 

Пришло время когда оптимизация производительности должна стать неотьемлемой 
частью процеса проектирования, написания и тестирования каждого сайта.

## Проектирование с учётом производительности

Производительность сайта начинается с дизайна. Задумайтесь как ваши дизайнерские 
решения влияют на скорость загрузки страниц и на показатели конверсии сайта. 
Действительно ли так уж необходимы восемь разных оттенков синего цвета? Какую 
пользу несет фоновое изображение шириной в тысячу пикселей? Приведет ли замена 
спрайта на иконочный шрифт к увеличению размера страниц и замедлению их 
загрузки, или же наоборот они будут загружаться быстрее?

Не все дизайнерские решения позитивно скажутся на производительности. Я 
заметила, что даже если стилизация кнопки немного замедляет скорость загрузки 
страницы, она все же может позитивно влиять на конверсию; в таких случаях стоит 
пойти на небольшие жертвы в плане производительности сайта. 

Однако, иногда производительность всетаки приоритетнее. В одно время я принимала 
участвие в редизайне целевой страницы, в результате которого количество 
изображений на ней существенно возросло. Я не была уверена скажется ли удар по 
производительности на конверсии, потому представила редизайн небольшой групе 
пользователей с целью провести [A/B-тестирование][3] и посмотреть каким будет 
результат. С новым дизайном загрузка страниц стала вдвое медленней и я сразу же 
заметила что показатели выходов возросли и показатели конверсии упали, потому 
было решено сохранить старый дизайн с меньшим весом. Ошибаться не зазорно, 
именно ошибки помогают набраться опыта в оценке производительности. 

В другом эксперименте, на главной странице [dyn.com][4] была помещена секция с 
10 ячейками, в которых попеременно отображались пиктограммы 26 изображений. 

![dyn.com][Главная страница dyn.com]

*Главная страница dyn.com*

Мой колега поместил все 26 изображений в спрайт, что:

* Увеличило общий размер главной страницы на 60Кб (с учётом увеличенного CSS, 
JavaScript и размера картинок, которые нужны для воспроизведения такого эффекта 
с использованием спрайта)

* Уменьшило количество запросов на 21 процент

* Сократило общее время загрузки главной страницы на целых 35 процентов

Это доказывает что поэкспериментировать стоит: мы не были уверены что идея со 
спрайтом ускорит загрузку страницы, но чувствовали что результат эксперимента 
принесет ценный опыт. 

## Написание кода с учётом производительности

Почистите свой HTML, и всё остальное подтянется.

Начните с переименования несемантических названий элементов в HTML. Это наверное 
самое сложное, но начав выбирать названия, вписывающиеся в рамки семантики 
(например, используя теги “nav” и “article”), и меньше ориентируясь на дизайн и 
сетку, вы сделаете значительный шаг вперёд. В CSS нам часто приходится 
использовать селекторы с большим весом при описании стилей для элементов с 
несемантическими названиями и, вместо того чтобы почистить CSS и задать 
специфичность правильным спобом, нам приходится добавлять лишние идентификаторы 
и элементы в наш HTML.

Затем почистите свой CSS. Сперва удалите непродуктивные селекторы. В 
исследовании для [writegoodcode.com][6], я обнаружила что добавление 
непродуктивных селекторов в файл CSS увеличило время загрузки страниц на 5,5 
процентов. Использование продуктивных селекторов облегчает будущий редизайн и 
корректировку стилей, поскольку файлы с такими селекторами легче читать, у них 
есть семантическое значение. К тому же, код, который легко корректировать, часто 
обеспечивает хорошую продуктивность страниц. В работе над этим проектом я 
сэкономила 39 процентов размера файлов CSS всего лишь почистив их. 

Дальше сосредоточьтесь на излечении HTML от лишних `div`-ов. Как правило, чем 
чище в результате ваша разметка, тем меньшими будут стили CSS, и тем легче 
впоследствии будет проводить редизайн и редактирование сайта. Это позволяет не 
только уменьшить время загрузки страницы, но и сэкономить время разработки. 

И наконец, приложите усилия, чтобы сделать код пригодным для многократного 
использования, это поможет сэкономить время и уменьшить размер файлов CSS и 
HTML. Для сайтов с меньшими обьемами кода HTML и CSS проще осуществлять 
поддержку и редизайн в будущем, меньшие размеры страниц также позитивно повлияют 
на скорость загрузки.

## Оптимизация запросов

Запросы - это когда браузеру нужно достать файл или DNS-запись. Чем чище 
разметка, тем меньше запросов нужно сделать браузеру, тем меньше времени 
пользователи будут ждать пока их браузеры разберутся что к чему. 

Кроме очистки разметки, сократите количество запросов JavaScript: оставьте 
только те, которые действительно необходимы. Не стоит запрашивать файл на каждой 
странице если он не нужен на каждой странице. Не стоит загружать файл JavaScript 
для всех вариантов отзывчивого дизайна если он нужен только для больших экранов; 
например, [замените скрипты социальных сетей на простые ссылки][7]. Также можно 
загружать JavaScript асинхронно чтобы он не мешал отображению какой-либо части 
контента.

Хоть для отзывчивого дизайна, как правило, используется больший обьем CSS и 
изображений (и значит у страницы больший размер), всё же можно ускорить загрузку 
больших страниц если избавиться от лишних запросов. 

## Оптимизация изображений

Также сократите запросы для изображений насколько это возможно. Во-первых, 
[используйте спрайты][8]. Проводя исследование по заказу writegoodcode.com, я 
обнаружила что использование спрайта для иконок тестовой страницы сократило 
время её загрузки на 16,6 процентов. Я предпочитаю начинать чистку изображений с 
создания одного спрайта для повторяющихся фоновых элементов. Иногда удобнее 
создать отдельный файл для фоновых изображений повторяющихся по вертикали и 
отдельный для изображений повторяющихся по горизонтали. 

Затем создайте один прозрачный спрайт для неповторяющихся фоновых изображений. 
Сюда попадут логотип и иконки. Опытные разработчики также могут использовать 
такие инструменты как [Grunticon][9], который определяет наилучший способ 
загрузки SVG-иконок и фоновых изображений согласно возможностям браузера 
пользователя. 

После преобразорвания изображений пропустите их через оптимизатор, например 
[ImageOptim][10]. Точно так же размер изображений, подготовленных для мониторов 
Retina, может быть уменьшен посредством [интенсивной компрессии][11] без потери 
качества. 

Теперь подумайте какие изображения можно заменить градиентами CSS3. Это поможет 
не только значительно уменьшить время загрузки страницы, но и существенно 
упросит дальнейшее редактирование кода сайта, ведь разработчику не нужно будет 
искать исходное изображение чтобы подкорректировать, обновить или повторно 
оптимизировать. 

И наконец, рассмотрите возможность использования [кодировки Base64][12], которая 
позволяет встраивать изображение в файл CSS, вместо того чтобы запрашивать его 
с сервера с помощью отдельного адреса URL. Вот так оно будет выглядеть в 
результате:

    #nav li:after {
        content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAI0lEQVQIW2P4//8/w8yZM//DMIjPAGPAMIiPWxCIMQQxzAQAoFpF7lGFr24AAAAASUVORK5CYII=);
    }

Беспорядочные буквы и цыфры составляют небольшое колечко, которое часто 
используется на [dyn.com][13]. Встраивание изображения позволяет сэкономить 
запрос каждый раз когда вы используете его в дизайне. Изображения, встроенные 
таким способом увеличивают размер файла CSS, так что стоит проверить время 
загрузки страниц до и после конвертации в Base64 чтобы убедиться что от неё есть 
польза.  

## Оценка производительности

Теперь перейдем к самому интересному: оценке эффективности приложенных усилий.

[PageSpeed][14] от Google и [YSlow][15] от Yahoo! предлагают советы по улучшению 
скорости загрузки страницы, они позволяют определить элементы, негативно 
влияющие на отображение страницы, и размеры компонентов страницы, например CSS 
или HTML.

Я также советую использовать [3PO][16], расширение YSlow, которое проверяет ваш 
сайт на интеграцию с популярными сторонними скриптами таких сервисов как 
Twitter, Facebook, and Google+. Этот плагин предлагает рекомендации по 
оптимизации скриптов социальных сервисов для уменьшения времени загрузки 
страницы. 

С того времени когда я начала вносить улучшения, ориентриуясь на подсказки 
PageSpeed и YSlow, я использую [WebPageTest.org][17] для оценки 
производительности. Он предоставляет очень детальную информацию о запросах, 
размере файлов и временных показателях, а также на нём можно протестировать 
поведение сайта в разных браузерах и локациях. 

Оценка производительности позволяет устранять проблемы в процессе разработки. 
Измеряя производительность и анализируя результаты, вы можете ускорить загрузку 
вашего сайта и для больших и для маленьких мониторов. Когда вы освоитесь с 
разработкой, ориентированной на максимальную производительность, также можно 
тестировать и оценивать влияние на производительность таких приёмов как 
[условная загрузка изображений][18]. 

## Влияние производительности

Производительность в вебе влияет на ваших пользователей, это нужно понимать, 
оценивать и улучшать производительность. Вышеписанные приёмы сократят время 
загрузки страниц, что поможет улучшить опыт взаимодействия пользователей с вашим 
сайтом. 

Счастливые пользователи ведут к лучшим показателям конверсии, в том числе 
обьемам прибыли, количеству подписчиков, или обьемам скачивания контента. При 
быстрой загрузке страниц люди могут использовать ваш сайт и совершать действия 
за небольшой промежуток времени, даже когда они ждут переключения светофора. 

[1]: http://www.websiteoptimization.com/speed/tweak/psychology-web-performance/
[2]: http://www.gomez.com/pdfs/wp_why_web_performance_matters.pdf
[3]: http://alistapart.com/article/a-primer-on-a-b-testing
[4]: http://dyn.com/
[5]: http://dyn.com/blog/how-we-got-dyndns-com-to-load-faster-and-how-you-can-learn-from-it/
[6]: http://writegoodcode.com/
[7]: http://www.zurb.com/article/883/small-painful-buttons-why-social-media-bu
[8]: http://alistapart.com/article/sprites/
[9]: http://filamentgroup.com/lab/grunticon
[10]: http://imageoptim.com/
[11]: http://blog.netvlies.nl/design-interactie/retina-revolution/
[12]: http://www.greywyvern.com/code/php/binary2base64
[13]: http://dyn.com/
[14]: https://developers.google.com/speed/pagespeed/
[15]: http://developer.yahoo.com/yslow/
[16]: http://www.phpied.com/3po/
[17]: http://www.webpagetest.org/
[18]: http://adactio.com/journal/5414/

[Главная страница dyn.com]: img/dyncomhomepage.jpg?raw=true&amp;repo=improving-ux-through-front-end-performance