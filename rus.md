# Улучшаем впечатление от сайта через оптимизацию производительности интерфейса

Представьте, что вы стоите на перекрёстке и ждёте когда можно будет перейти 
дорогу. Вы нажимаете кнопку переключения светофора и достаёте телефон. Вы хотите 
совершить какое-то действие: возможно, проверить почту, добавить заметку в список 
задач или полистать Твиттер. У вас есть ограниченое количество времени на то, 
чтобы совершить это действие. 

Именно за такое количество времени пользователи должны иметь 
возможность что-либо сделать на вашем сайте. И очень важно это учитывать. 

Как показывает исследование Google, дополнительные полсекунды при загрузке страницы 
поиска могут снизить прибыль и трафик на 20 процентов. [Статья об 
этом исследовании][1] также содержит данные о подсчетах команды Amazon, согласно 
которым дополнительные 100 *милисекунд* задержки при загрузке страниц снижают 
обьемы продаж на 1 процент. Пользователи ожидают, что страница загрузится за 
две секунды, подождав три секунды до 40 процентов посетителей [просто уйдёт с сайта][2]. 

Может ли ваш сайт соответствовать этим требованиями? Если вы, как и 
большинство из нас, занимаетесь разработкой сайтов, насыщенных контентом, 
множеством динамических элементов, большими 
JavaScript-файлами и сложной графикой, ответ, скорее всего, будет «нет». 

Пришло время, когда оптимизация производительности должна стать основной 
частью процеса проектирования, разработки и тестирования каждого сайта.

## Проектирование с учётом производительности

Производительность сайта начинается с дизайна. Задумайтесь, как ваши дизайнерские 
решения влияют на скорость загрузки страниц и на показатели конверсии сайта. 
Действительно ли так уж необходимы восемь разных оттенков синего цвета? Какую 
пользу несёт фоновое изображение шириной в тысячу пикселей? Приведет ли замена 
спрайта на иконочный шрифт к увеличению размера страниц и замедлению их 
загрузки, или же наоборот — они будут загружаться быстрее?

Не все дизайнерские решения позитивно скажутся на производительности. Я 
заметила, что даже если стилизация кнопки немного замедляет скорость загрузки 
страницы, она все же может позитивно влиять на конверсию; в таких случаях стоит 
пойти на небольшие жертвы с точки зрения производительности сайта. 

Однако иногда производительность всё-таки приоритетнее. Однажды я принимала 
участвие в редизайне целевой страницы, в результате которого количество 
изображений на ней существенно возросло. Я не была уверена скажется ли 
такое значительное снижение производительности на конверсии, 
поэтому включила редизайн для небольшой группы 
пользователей с целью провести [A/B-тестирование][3] и посмотреть каким будет 
результат. С новым дизайном загрузка страниц стала занимать вдвое больше времени,
и я сразу же заметила, что показатели выходов возросли, а показатели конверсии упали, поэтому было решено сохранить старый более легковесный дизайн. 
Ошибаться нормально, именно ошибки помогают нам получать опыт. 

В рамках другого эксперимента на главной странице [dyn.com][4] была 
помещена секция с 10 ячейками, в которых попеременно отображалось 
26 изображений. 

![dyn.com][Главная страница dyn.com]

*Главная страница dyn.com*

Мой коллега поместил все 26 изображений в спрайт, что:

* Увеличило общий размер главной страницы на 60Кб (с учётом увеличенного CSS, 
JavaScript и размера картинок, которые нужны для создания этого элемента 
с использованием спрайта)

* Уменьшило количество запросов к серверу на 21 процент

* Сократило общее время загрузки главной страницы на целых 35 процентов

Это доказывает, что экспериментировать стоит: мы не были уверены, что идея со 
спрайтом ускорит загрузку страницы, но чувствовали, что эксперимент 
позволит получить ценный опыт. 

## Написание кода с учётом производительности

Очистите свой HTML, а остальное приложится.

Начните с переименования несемантических названий элементов в HTML. Это, наверное, 
самое сложное, но начав выбирать названия, вписывающиеся в рамки семантики 
(например, используя теги “nav” и “article”), и меньше ориентируясь на дизайн и 
сетку, вы сделаете значительный шаг вперёд. В CSS нам часто приходится 
использовать селекторы с большим весом, чтобы обратиться к элементам с 
несемантическими названиями и, вместо того чтобы почистить CSS и задать 
специфичность правильным спобом, нам приходится добавлять лишние идентификаторы 
и элементы в HTML.

Затем приведите в порядок свой CSS. Сперва удалите неэффективные селекторы. В 
исследовании, которое я проводила для [writegoodcode.com][6], 
я обнаружила, что добавление неэффективных селекторов 
в CSS-файл увеличило время загрузки страниц на 5,5 
процентов. Использование продуманных селекторов облегчает будущий редизайн и 
редактирование стилей, потому что их легче читать, у них 
есть семантическое значение. К тому же код, который легко редактировать, часто 
положительно влияет на производительность страниц. В работе над этим проектом я 
уменьшила файлы со стилями на 39 процентов всего лишь почистив CSS. 

Следующим шагом сосредоточьтесь на излечении HTML от `div`-атоза. Как правило, чем 
чище становится ваша разметка, тем легче будет CSS, и тем проще 
будет поддержка и редизайн сайта в дальнейшем. Это позволит уменьшить не 
только время загрузки страницы, но и время на разработку. 

И наконец, постарайтесь создавать переиспользуемый код, это 
поможет сэкономить время и уменьшить размер файлов CSS и 
HTML. Меньший обьем HTML и CSS позволит значительно облегчить 
поддержку и редизайн в будущем, а небольшой вес файлов также 
положительно влияет на скорость загрузки страницы.

## Оптимизация запросов

Запросы - это когда браузеру нужно загрузить что-нибудь вроде 
файла или DNS-записи. Чем чище разметка, тем меньше запросов 
нужно сделать браузеру, тем меньше времени 
пользователи будут ждать пока их браузеры разберутся что к чему. 

Кроме очистки разметки, сократите количество запросов JavaScript: оставьте 
только те, которые действительно необходимы. Не загружайте файл на каждой 
странице, если он не должен быть на каждой странице. 
Не стоит загружать JavaScript-файл для всех вариантов 
отзывчивого дизайна, если он нужен только для больших экранов; 
например, [замените скрипты социальных сетей на простые ссылки][7]. Также можно 
загружать JavaScript асинхронно, чтобы он не блокировал отображение 
контента.

Хотя для отзывчивого дизайна, как правило, используется больший обьем CSS и 
изображений (а значит, страница больше весит), всё же можно ускорить загрузку 
больших страниц, если избавиться от лишних запросов. 

## Оптимизация изображений

Сократите количество загружаемых изображений, насколько это возможно. Во-первых, 
[используйте спрайты][8]. В своём исследовании по заказу writegoodcode.com я 
обнаружила, что использование спрайта для иконок на тестовой странице сократило 
время её загрузки на 16,6 процентов. Я предпочитаю начинать чистку изображений с 
создания одного спрайта для повторяющихся фоновых элементов. Иногда удобнее 
создать один файл для фоновых изображений повторяющихся по вертикали и 
другой для изображений повторяющихся по горизонтали. 

Затем создайте один прозрачный спрайт для неповторяющихся фоновых изображений. 
Сюда попадут логотип и иконки. Опытные разработчики также могут использовать 
инструменты вроде [Grunticon][9], который определяет наилучший способ 
загрузки SVG-иконок и фоновых изображений исходя из возможностей браузера 
пользователя. 

Затем переработанные изображения пропустите их через оптимизатор, например 
[ImageOptim][10]. Аналогично, размер изображений для Retina 
может быть уменьшен без потери качества посредством [интенсивной компрессии][11]. 

Теперь подумайте какие изображения можно заменить CSS3-градиентами. Это поможет 
не только значительно уменьшить время загрузки страницы, но и существенно 
упросит дальнейшую поддержку сайта, так как разработчику не нужно будет 
искать исходное изображение, чтобы его подкорректировать, обновить или повторно 
оптимизировать. 

И наконец, подумайте об использовании [кодировки Base64][12], которая 
позволяет встраивать изображение непосредственно в CSS, вместо 
того, чтобы запрашивать его с сервера. Вот так это будет выглядеть в итоге:

    #nav li:after {
        content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAI0lEQVQIW2P4//8/w8yZM//DMIjPAGPAMIiPWxCIMQQxzAQAoFpF7lGFr24AAAAASUVORK5CYII=);
    }

Этот беспорядочный набор букв и цифр представляют собой небольшой кружочек, 
который очень часто используется на сайте [dyn.com][13]. Встраивание изображения 
избавляет от необходимости делать запрос к серверу каждый раз когда вы используете 
его в дизайне. Изображения, встроенные таким способом, увеличивают 
размер CSS-файла, так что стоит проверить время загрузки страниц 
до и после использования Base64 чтобы убедиться, что это положительно влияет 
на производительность.  

## Оценка производительности

Теперь перейдем к самому интересному: оценке эффективности приложенных усилий.

[PageSpeed][14] от Google и [YSlow][15] от Yahoo! предлагают советы по улучшению 
скорости загрузки страницы, они позволяют определить элементы, блокирующие 
отрисовку страницы, и размеры компонентов страницы, например, CSS 
или HTML.

Я также советую использовать [3PO][16], расширение YSlow, которое проверяет ваш 
сайт на интеграцию с популярными сторонними скриптами таких сервисов как 
Twitter, Facebook, and Google+. Плагин может предложить рекомендации по 
оптимизации скриптов социальных сервисов для уменьшения времени загрузки 
страницы. 

С того времени когда я начала вносить улучшения, ориентриуясь на подсказки 
PageSpeed и YSlow, я использую [WebPageTest.org][17] для оценки 
производительности. Он предоставляет очень детальную информацию о запросах, 
размере файлов и временных показателях, а также на нём можно протестировать 
поведение сайта в разных браузерах и условиях. 

Оценка производительности позволяет устранять проблемы в процессе разработки. 
Измеряя производительность и анализируя результаты, вы можете ускорить загрузку 
вашего сайта и для больших экранов, и для маленьких устройств. Когда вы освоитесь с 
разработкой, ориентированной на производительность, также можете 
потестировать и оценить влияние на производительность таких приёмов как 
[условная загрузка изображений][18]. 

## Влияние производительности

Производительность в вебе непосредственно затрагивает ваших пользователей, 
а это означает, что каждый из нас должен уделять внимание 
оценке и улучшению производительности. 
Вышеписанные приёмы сократят время загрузки страниц, что поможет 
сделать работу с вашим сайтом значительно удобнее. 

Счастливые пользователи означают лучшие показатели конверсии, в том числе 
увеличение прибыли, рост числа подписчиков или обьема скачивания контента. При 
быстрой загрузке страниц люди могут использовать ваш сайт и совершать действия 
за небольшой промежуток времени, даже когда они ждут переключения светофора. 

[1]: http://www.websiteoptimization.com/speed/tweak/psychology-web-performance/
[2]: http://www.gomez.com/pdfs/wp_why_web_performance_matters.pdf
[3]: http://alistapart.com/article/a-primer-on-a-b-testing
[4]: http://dyn.com/
[5]: http://dyn.com/blog/how-we-got-dyndns-com-to-load-faster-and-how-you-can-learn-from-it/
[6]: http://writegoodcode.com/
[7]: http://www.zurb.com/article/883/small-painful-buttons-why-social-media-bu
[8]: http://alistapart.com/article/sprites/
[9]: http://filamentgroup.com/lab/grunticon
[10]: http://imageoptim.com/
[11]: http://blog.netvlies.nl/design-interactie/retina-revolution/
[12]: http://www.greywyvern.com/code/php/binary2base64
[13]: http://dyn.com/
[14]: https://developers.google.com/speed/pagespeed/
[15]: http://developer.yahoo.com/yslow/
[16]: http://www.phpied.com/3po/
[17]: http://www.webpagetest.org/
[18]: http://adactio.com/journal/5414/

[Главная страница dyn.com]: img/dyncomhomepage.jpg?raw=true&amp;repo=improving-ux-through-front-end-performance
